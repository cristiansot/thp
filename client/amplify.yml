version: 0.2  # Actualización de la versión para que sea compatible con CodeBuild

applications:
  - appRoot: client
    backend:
      phases:
        preBuild:
          commands:
            - echo "Desactivando integración con SSM"
            - export USE_SSM=false  # Desactiva SSM configurando una variable de entorno (si es necesario)
            - echo "Desactivando secretos"
            - export USE_SECRETS=false  # Desactiva los secretos (si es necesario)
        build:
          commands:
            - echo "Construyendo el backend sin integración con SSM ni secretos"
            - # Aquí agregarías los comandos necesarios para construir tu backend, por ejemplo:
            - npm install  # Ejemplo para Node.js
            - npm run build  # Si es necesario construir el backend

    frontend:
      phases:
        preBuild:
          commands:
            - echo "Desactivando integración con secretos para el frontend"
            - export USE_SECRETS=false  # Desactivar secretos en el frontend si es necesario
        build:
          commands:
            - echo "Construyendo el frontend sin secretos"
            - cd client  # Si tienes una carpeta 'client' en tu proyecto
            - npm install  # Instalar dependencias frontend
            - npm run build  # Construir frontend

    # Definición de los artefactos generados por la construcción
    artifacts:
      files:
        - '**/*'  # Esto incluirá todos los archivos generados en el proceso de construcción
      discard-paths: yes  # Para eliminar las rutas de directorios y mantener solo los archivos

    # Si tienes algún cache o dependencias que quieras almacenar entre builds, puedes agregar un cache.
    cache:
      paths:
        - '/root/.npm/**/*'  # Por ejemplo, cachear las dependencias de npm
